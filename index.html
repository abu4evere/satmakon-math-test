<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SATMAKON Math Level Test</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    /* Existing styles unchanged */
    :root {
      --primary: #3B2289;
      --primary-dark: #2A1966;
      --primary-light: #B7A8E3;
      --secondary: #10B981;
      --danger: #EF4444;
      --warning: #F59E0B;
      --dark: #1F2937;
      --light: #F9FAFB;
      --gray: #6B7280;
      --light-gray: #E5E7EB;
      --white: #FFFFFF;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --radius-sm: 0.25rem;
      --radius: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
      color: var(--dark);
      font-family: 'Inter', sans-serif;
      line-height: 1.5;
      padding: 1rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      background: var(--white);
      width: 100%;
      max-width: 800px;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      transition: transform 0.3s ease;
      position: relative;
    }

    .container:hover {
      transform: translateY(-5px);
    }

    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--white);
      padding: 2rem 1.5rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      transform: rotate(30deg);
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
    }

    h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      position: relative;
    }

    h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .content {
      padding: 2rem 1.5rem;
    }

    p {
      color: var(--dark);
      margin-bottom: 1rem;
    }

    .header p {
      color: var(--primary-light);
      font-size: 1.1rem;
      font-weight: 400;
    }

    .timer {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: var(--primary);
      color: var(--white);
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: var(--shadow);
      z-index: 100;
      transition: all 0.3s ease;
    }

    .timer.low-time {
      background: var(--danger);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .progress-container {
      margin-bottom: 2rem;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
      color: var(--gray);
    }

    .progress-bar {
      height: 0.75rem;
      background: var(--light-gray);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
      width: 0;
      border-radius: var(--radius);
      transition: width 0.3s ease;
    }

    .question {
      background: var(--white);
      border: 1px solid var(--light-gray);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      position: relative;
    }

    .question-number {
      position: absolute;
      top: -0.75rem;
      left: 1.5rem;
      background: var(--primary);
      color: var(--white);
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .question.answered {
      border-left: 4px solid var(--primary-light);
    }

    .question h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--dark);
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid var(--light-gray);
    }

    .option:hover {
      background: var(--light);
      border-color: var(--primary-light);
    }

    .option.selected {
      background: var(--primary-light);
      border-color: var(--primary);
    }

    .option input {
      opacity: 0;
      position: absolute;
    }

    .option-radio, .option-checkbox {
      width: 1.25rem;
      height: 1.25rem;
      border: 2px solid var(--gray);
      flex-shrink: 0;
      margin-top: 0.125rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .option-radio {
      border-radius: 50%;
    }

    .option-checkbox {
      border-radius: 4px;
    }

    .option.selected .option-radio, .option.selected .option-checkbox {
      border-color: var(--primary);
      background: var(--primary);
    }

    .option-radio::after {
      content: "";
      width: 0.625rem;
      height: 0.625rem;
      background: var(--white);
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .option-checkbox::after {
      content: "\f00c";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      color: var(--white);
      font-size: 0.75rem;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .option.selected .option-radio::after, .option.selected .option-checkbox::after {
      opacity: 1;
    }

    .option-text {
      flex: 1;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      background: var(--primary);
      color: var(--white);
      box-shadow: var(--shadow-sm);
      gap: 0.5rem;
    }

    .btn:hover {
      background: var(--primary-dark);
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-block {
      display: flex;
      width: 100%;
    }

    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1.125rem;
    }

    .result-card {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 2rem;
      text-align: center;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
    }

    .score {
      font-size: 3rem;
      font-weight: 700;
      color: var(--primary);
      margin: 1rem 0;
    }

    .group-badge {
      display: inline-block;
      background: var(--primary);
      color: var(--white);
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      font-weight: 600;
      margin: 1rem 0;
    }

    .hidden {
      display: none !important;
    }

    .welcome-icon {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .test-info {
      background: var(--light);
      border-radius: var(--radius);
      padding: 1rem;
      margin: 1.5rem 0;
    }

    .test-info-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .test-info-item:last-child {
      margin-bottom: 0;
    }

    .test-info-icon {
      color: var(--primary);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 500px;
      padding: 2rem;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
      position: relative;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      margin-bottom: 1.5rem;
      text-align: center;
      position: relative;
    }

    .modal-header h2 {
      color: var(--primary);
    }

    .modal-close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: var(--gray);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .modal-close-btn:hover {
      color: var(--danger);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 34, 137, 0.1);
    }

    .error-message {
      color: var(--danger);
      font-size: 0.875rem;
      margin-top: 0.25rem;
      display: none;
    }

    .saved-result-item {
      background: var(--light);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .saved-result-item h3 {
      margin-bottom: 0.5rem;
      color: var(--primary);
    }

    .saved-result-meta {
      display: flex;
      gap: 1rem;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .saved-result-score {
      font-weight: 600;
      color: var(--primary-dark);
    }

    .admin-controls {
      margin: 1.5rem 0;
      padding: 1rem;
      background: var(--light);
      border-radius: var(--radius);
    }

    .admin-login-form {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .admin-login-form input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-sm);
    }

    .admin-only {
      display: none !important;
    }

    /* New styles for Google Form */
    #google-form-container {
      margin: 20px auto;
      max-width: 800px;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }

    @media (max-width: 640px) {
      .header {
        padding: 1.5rem 1rem;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .content {
        padding: 1.5rem 1rem;
      }
      
      .question {
        padding: 1.25rem 1rem;
      }
      
      .btn-lg {
        padding: 0.875rem 1.5rem;
        font-size: 1rem;
      }

      .modal-content {
        padding: 1.5rem;
        margin: 0 1rem;
      }

      .btn-group {
        flex-direction: column;
      }
      
      .admin-login-form {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="timer hidden" id="timer">
    <i class="fas fa-clock"></i>
    <span id="timer-text">45:00</span>
  </div>
  
  <main class="container">
    <div class="header">
      <h1>SATMAKON Math Level Test</h1>
      <p>Assess your math skills and find your perfect learning path</p>
    </div>
    
    <section id="start-screen" class="content">
      <div class="welcome-icon">
        <i class="fas fa-calculator"></i>
      </div>
      <h2>Welcome to the Math Level Test!</h2>
      <p>This comprehensive test will evaluate your current math knowledge and help us place you in the right learning group.</p>
      
      <div class="test-info">
        <div class="test-info-item">
          <i class="fas fa-question-circle test-info-icon"></i>
          <span>30 carefully crafted questions</span>
        </div>
        <div class="test-info-item">
          <i class="fas fa-stopwatch test-info-icon"></i>
          <span>45 minute time limit</span>
        </div>
        <div class="test-info-item">
          <i class="fas fa-chart-line test-info-icon"></i>
          <span>Immediate results with personalized feedback</span>
        </div>
      </div>
      
      <div class="admin-controls" id="admin-controls">
        <div id="admin-login-section">
          <h3>Admin Access</h3>
          <div class="admin-login-form">
            <input type="password" id="admin-password" placeholder="Enter admin password" class="form-control">
            <button class="btn" onclick="checkAdminPassword()">
              <i class="fas fa-lock"></i> Login
            </button>
          </div>
        </div>
        <div id="admin-actions" class="hidden">
          <button class="btn btn-block" onclick="downloadAllResults()">
            <i class="fas fa-download"></i> Download All Results
          </button>
          <button class="btn btn-block" onclick="viewSavedResults()" style="margin-top: 0.5rem;">
            <i class="fas fa-list"></i> View All Results
          </button>
        </div>
      </div>

      <button class="btn btn-lg btn-block" id="start-test-btn">
        <i class="fas fa-play"></i> Start Test
      </button>
    </section>

    <section id="test-screen" class="content hidden">
      <div class="progress-container">
        <div class="progress-header">
          <span>Question <span id="current-question">1</span> of <span id="total-questions">30</span></span>
          <span id="progress-percent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>
      
      <form id="quiz-form" aria-label="SAT Math Level Test">
        <div id="questions-container"></div>
        <button type="submit" class="btn btn-lg btn-block">
          <i class="fas fa-paper-plane"></i> Submit Test
        </button>
      </form>
    </section>

    <section id="result-screen" class="content hidden">
      <div class="result-card fade-in">
        <i class="fas fa-trophy" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
        <h2>Test Completed!</h2>
        <div class="score" id="score-display">0</div>
        <p>out of 30 questions</p>
        <div class="group-badge" id="group-badge">Pre-Foundation Math</div>
        <p id="result-message">Based on your results, we recommend starting with our Pre-Foundation Math course.</p>
        
        <div id="student-info-display" style="margin-top: 2rem; text-align: left; background: var(--light); padding: 1rem; border-radius: var(--radius);">
          <h3 style="margin-bottom: 1rem;">Student Information</h3>
          <p><strong>Name:</strong> <span id="display-name"></span></p>
          <p><strong>Surname:</strong> <span id="display-surname"></span></p>
          <p><strong>Phone:</strong> <span id="display-phone"></span></p>
          <p><strong>Test Date:</strong> <span id="test-date"></span></p>
        </div>
      </div>
      
      <!-- Add Google Form container -->
      <div id="google-form-container" class="hidden">
        <iframe src="https://docs.google.com/forms/d/e/YOUR_FORM_ID/viewform?embedded=true" 
                width="100%" 
                height="800" 
                frameborder="0" 
                marginheight="0" 
                marginwidth="0">
          Loading...
        </iframe>
      </div>
      
      <div class="btn-group" style="display: flex; gap: 1rem; margin-top: 1rem;">
        <button class="btn btn-lg admin-only" onclick="viewSavedResults()" style="flex: 1;">
          <i class="fas fa-list"></i> View All Results
        </button>
      </div>
      
      <div class="admin-controls" id="admin-controls-result">
        <div id="admin-login-section-result">
          <h3>Admin Access</h3>
          <div class="admin-login-form">
            <input type="password" id="admin-password-result" placeholder="Enter admin password" class="form-control">
            <button class="btn" onclick="checkAdminPassword()">
              <i class="fas fa-lock"></i> Login
            </button>
          </div>
        </div>
        <div id="admin-actions-result" class="hidden">
          <button class="btn btn-block" onclick="downloadAllResults()">
            <i class="fas fa-download"></i> Download All Results
          </button>
        </div>
      </div>
    </section>

    <section id="saved-results-screen" class="content hidden">
      <div class="result-card">
        <h2>Saved Test Results</h2>
        <div id="saved-results-list" style="max-height: 400px; overflow-y: auto; margin: 1rem 0;">
          <!-- Results will be displayed here -->
        </div>
        <button class="btn btn-lg btn-block" onclick="backToResults()">
          <i class="fas fa-arrow-left"></i> Back to Results
        </button>
      </div>
    </section>
  </main>

  <div class="modal-overlay" id="student-info-modal">
    <div class="modal-content">
      <div class="modal-header">
        <button class="modal-close-btn" onclick="closeStudentInfoModal()">
          <i class="fas fa-times"></i>
        </button>
        <h2>Enter Your Information</h2>
        <p>Please provide your details to begin the test</p>
      </div>
      
      <form id="student-info-form">
        <div class="form-group">
          <label for="student-name">Name</label>
          <input type="text" id="student-name" class="form-control" required>
          <div class="error-message" id="name-error">Please enter your name</div>
        </div>
        
        <div class="form-group">
          <label for="student-surname">Surname</label>
          <input type="text" id="student-surname" class="form-control" required>
          <div class="error-message" id="surname-error">Please enter your surname</div>
        </div>
        
        <div class="form-group">
          <label for="student-phone">Telephone Number</label>
          <input type="tel" id="student-phone" class="form-control" required>
          <div class="error-message" id="phone-error">Please enter a valid telephone number</div>
        </div>
        
        <button type="submit" class="btn btn-lg btn-block">
          <i class="fas fa-check"></i> Confirm and Start Test
        </button>
      </form>
    </div>
  </div>

  <script>
    console.log('Script loaded');

    const questions = [
      {
        question: "If 3(x − 5) = 15, what does <sup>x−5</sup>⁄<sub>x+5</sub> equal?",
        options: ["<sup>2</sup>⁄<sub>3</sub>", "<sup>1</sup>⁄<sub>7</sub>", "<sup>4</sup>⁄<sub>3</sub>", "<sup>1</sup>⁄<sub>3</sub>"],
        correct: "<sup>1</sup>⁄<sub>3</sub>"
      },
      {
        question: "(x<sup>2</sup> − 3) − (−3x<sup>2</sup> + 5)<br>Which of the following expressions is equivalent to the one above?",
        options: ["4x<sup>2</sup> − 8", "4x<sup>2</sup> − 2", "−2x<sup>2</sup> − 8", "−2x<sup>2</sup> − 2"],
        correct: "4x<sup>2</sup> − 8"
      },
      {
        question: "(x + 3)(4x<sup>2</sup> − 5x + 1)<br>Which of the following is an equivalent form of this expression?",
        options: ["4x<sup>3</sup> + 7x<sup>2</sup> + 14x + 3", "4x<sup>3</sup> + 7x<sup>2</sup> − 14x + 3", "4x<sup>3</sup> − 7x<sup>2</sup> + 14x + 3", "4x<sup>3</sup> − 7x<sup>2</sup> − 14x + 3"],
        correct: "4x<sup>3</sup> + 7x<sup>2</sup> − 14x + 3"
      },
      {
        question: "If 2y + 5 = −3y + 12x, what is the value of y in terms of x?",
        options: ["(12x + 5) / (2 + 3)", "(12x − 5) / (2 + 3)", "(12x + 5) / (2 − 3)", "(12x − 5) / (2 − 3)"],
        correct: "(12x − 5) / (2 − 3)"
      },
      {
        question: "9x − 13 ≤ 2x + 8<br>Which of the following is the solution set for this inequality?",
        options: ["x ≤ 3", "x ≥ 3", "x ≤ −3", "x ≥ −3"],
        correct: "x ≤ 3"
      },
      {
        question: "Which of the following expressions is an equivalent form of the expression<br>(2x + 2)<sup>2</sup> + (2x + 2)?",
        options: ["2x<sup>2</sup> + 10x + 6", "4x<sup>2</sup> + 10x + 6", "(2x + 2)(2x + 3)", "(4x + 8)(x + 1)"],
        correct: "(2x + 2)(2x + 3)"
      },
      {
        question: "Which of the following is equivalent to the equation below where x ≠ 2?<br><img src='./7.PNG' alt='Equation: (3x + 4)/(x - 2)' style='width: 150px; height: auto;'>",
        options: ["6 / (x − 2)", "22 / (3x − 2)", "16 / (3x − 6)", "28 / (3x − 6)"],
        correct: "16 / (3x − 6)"
      },
      {
        question: "If the ratio of y : 2.4 is equivalent to 2.7 : 3.6, what is the value of y?",
        options: ["3/2", "4/3", "7/3", "9/5"],
        correct: "9/5"
      },
      {
        question: "y = x<sup>2</sup> + 1<br>y = x - 1<br><img src='./9.PNG' alt='Graph of y = x^2 + 1 and y = x - 1' style='width: 250px; height: auto;'><br>A system of two equations and their graphs in the xy-plane are shown below. How many solutions does the system have?",
        options: ["Zero", "One", "Two", "Three"],
        correct: "Two"
      },
      {
        question: "Chris was skateboarding at 8 feet per second when he came to the top of a hill. After riding down the hill for 3.5 seconds, he was moving at 43 feet per second. Assuming the acceleration was constant, what was his acceleration in feet per second squared?",
        options: ["8", "10", "12", "14"],
        correct: "10"
      },
      {
        question: "The number of electronic bikes sold by a particular retailer in a city can be modeled with the function <em>f(t) = 760(1.65)<sup>t</sup></em>, where t is the number of years since 2019. Which of the following is true?",
        options: [
          "The number of electronic bikes sold by this particular retailer is increasing by 760 per year.",
          "The number of bikes sold by this particular retailer in 2020 is 494 more than the number sold in 2019.",
          "The number of electronic bikes sold by this particular retailer is increasing by 165% per year.",
          "The number of electronic bikes sold by this particular retailer is increasing by 65% per year."
        ],
        correct: "The number of electronic bikes sold by this particular retailer is increasing by 65% per year."
      },
      {
        question: "What is the sum of the solutions of the equation<br> x<sup>2</sup> - 4x - 21 = 0?",
        options: ["-10", "-4", "3", "4"],
        correct: "4"
      },
      {
        question: "What is the remainder when x<sup>2</sup> + 2x + 1 is divided by x + 4?",
        options: ["4", "2", "1", "9"],
        correct: "9"
      },
      {
        question: "<img src='./14.PNG' alt='Table showing baseball team game results by favorite or underdog status' style='width: 250px; height: auto;'><br>The table above shows the results of a baseball team, categorized by whether the team was considered the favourite (expected to win) in the game or the underdog (expected to lose). What fraction of the games in which the team was considered the underdog did the team win?",
        options: ["2/5", "2/7", "2/9", "2/15"],
        correct: "2/9"
      },
      {
        question: "<br><img src='./17.PNG' alt='Geometric figure showing angle AED' style='width: 260px; height: auto;'><br>Note: Figure not drawn to scale.<br>In the figure above, what is the measure of <AED in degrees?",
        options: ["125", "135", "115", "145"],
        correct: "135"
      },
      {
        question: "What is the value of f(-3) given f(x)=3x<sup>2</sup>+3x+10",
        options: ["-46", "-26", "28", "36"],
        correct: "28"
      },
      {
        question: "(x-1)<sup>2</sup>=3x-5<br>What is one possible solution to the equation above?",
        options: ["2", "3", "7", "1"],
        correct: ["2", "3"],
        multiSelect: true
      },
      {
        question: "In the xy-plane, which of the following points lies in the interior of a circle with the equation (x+h)<sup>2</sup>+(y+k)<sup>2</sup>=289",
        options: ["(-h-15,-k+8)", "(-h+8,-k+7)", "(-h-8,-k-15)", "(-h+17,-k-1)"],
        correct: "(-h-8,-k-15)"
      },
      {
        question: "Two numbers, a and b, are each greater than zero, and the square root of a is equal to the cube root of b. For what value of x is a<sup>2x-1</sup> equal to b?",
        options: ["5/6", "7/6", "5/4", "4/5"],
        correct: "5/4"
      },
      {
        question: "In the xy-plane, the line y=2x+b intersects the parabola y=x<sup>2</sup>+bx+5 at the point (3,k). If b is a constant, what is the value of k?",
        options: ["0", "1", "2", "3"],
        correct: "2"
      },
      {
        question: "The side lengths of a triangle are given in the figure below. What does sin C equal?<br><img src='./21.PNG' alt='Geometric figure showing angle AED' style='width: 180px; height: auto;'>",
        options: ["2", "2/3", "1/2", "3/4"],
        correct: "1/2"
      },
      {
        question: "Which of the following is equivalent to<br> 5x<sup>3</sup>-6x<sup>2</sup>-9x+10x<sup>2</sup>+8x-4?",
        options: ["5x<sup>3</sup>+4x<sup>2</sup>+x-4", "5x<sup>3</sup>+4x<sup>2</sup>-x-4", "5x<sup>3</sup>-4x<sup>2</sup>+x-4", "5x<sup>3</sup>-4x<sup>2</sup>-x-4"],
        correct: "5x<sup>3</sup>+4x<sup>2</sup>-x-4"
      },
      {
        question: "2x-5y=k<br>-8x+20y=-24<br>What value of k in this system of equations produces infinitely many solutions?",
        options: ["0", "1", "6", "4"],
        correct: "6"
      },
      {
        question: "<img src='./24.PNG' alt='Graph of a system of inequalities' style='width: 220px; height: auto;'><br>This graph represents which of the following systems of linear inequalities?",
        options: [
          "y ≤ 2x - 3<br>y ≤ -x + 2",
          "y ≤ 2x - 3<br>y ≥ -x + 2",
          "y ≥ 2x - 3<br>y ≤ -x + 2",
          "y ≥ 2x - 3<br>y ≥ -x + 2"
        ],
        correct: "y ≥ 2x - 3<br>y ≤ -x + 2"
      },
      {
        question: "Find the value of y<br>22 - | y + 14 | = 20",
        options: ["-12", "-14", "2", "-16"],
        correct: ["-12", "-16"],
        multiSelect: true
      },
      {
        question: "<img src='./26.PNG' alt='Geometric figure showing angle AED' style='width: 300px; height: auto;'><br>In the geometric figure shown here, JK = KL, LM = MN, and triangle KLM is a right triangle. If x=115 then angle LMN measures which of the following?",
        options: ["130", "135", "140", "145"],
        correct: "130"
      },
      {
        question: "Which of the following expressions is equivalent to<br>x<sup>2</sup>-5",
        options: ["(x+√5)<sup>2</sup>", "(x-√5)<sup>2</sup>", "(x-√5)(x+√5)", "(x+5)(x-1)"],
        correct: "(x-√5)(x+√5)"
      },
      {
        question: "In the linear function f, f(0)=15, and f(1)=20. Which equation defines f?",
        options: ["f(x)=20x+15", "f(x)=5x", "f(x)=5x+15", "f(x)=5x+20"],
        correct: "f(x)=5x+15"
      },
      {
        question: "4a+3b=22<br>3a+2b=16<br>In the system of equation above, what is the value a+b?",
        options: ["10", "8", "7", "6"],
        correct: "6"
      },
      {
        question: "Julie spent 2 hours and 20 minutes per day studying for her SAT over the first three week of April. During the last week in April, she studied an extra 30% each day. How much time did Julie spend studying during the last week?",
        options: ["3 hours and 2 minutes", "2 hours and 2 minutes", "20 hours and 2 minutes", "21 hours and 14 minutes"],
        correct: "21 hours and 14 minutes"
      }
    ];
<script>
  console.log('Script loaded');

  const questions = [ /* Unchanged questions array, omitted for brevity */ ];

  const totalTime = 45 * 60;
  let timeLeft = totalTime;
  let timerInterval;
  let userAnswers = Array(questions.length).fill(null);
  let studentInfo = {
    name: '',
    surname: '',
    phone: '',
    testDate: ''
  };

  // Helper to safely get elements
  function getElement(id) {
    const el = document.getElementById(id);
    if (!el) console.error(`Element with ID ${id} not found`);
    return el;
  }

  console.log('Setting up event listeners');
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded');

    const modal = getElement('student-info-modal');
    const startTestBtn = getElement('start-test-btn');
    const studentInfoForm = getElement('student-info-form');

    if (!startTestBtn || !modal || !studentInfoForm) {
      console.error('Required elements missing:', { startTestBtn, modal, studentInfoForm });
      return;
    }

    console.log('Attaching start button listener');
    startTestBtn.addEventListener('click', function() {
      console.log('Start Test button clicked');
      modal.classList.add('active');
    });

    studentInfoForm.addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('Student info form submitted');

      const name = getElement('student-name')?.value.trim();
      const surname = getElement('student-surname')?.value.trim();
      const phone = getElement('student-phone')?.value.trim();

      let isValid = true;

      if (!name) {
        getElement('name-error').style.display = 'block';
        isValid = false;
      } else {
        getElement('name-error').style.display = 'none';
      }

      if (!surname) {
        getElement('surname-error').style.display = 'block';
        isValid = false;
      } else {
        getElement('surname-error').style.display = 'none';
      }

      if (!phone || !/^[\d\s\-()+]{8,}$/.test(phone)) {
        getElement('phone-error').style.display = 'block';
        isValid = false;
      } else {
        getElement('phone-error').style.display = 'none';
      }

      if (isValid) {
        studentInfo = { name, surname, phone, testDate: new Date().toLocaleString() };
        console.log('Student info saved:', studentInfo);
        modal.classList.remove('active');
        startTest();
      }
    });

    const quizForm = getElement('quiz-form');
    if (quizForm) {
      quizForm.addEventListener('submit', function(event) {
        event.preventDefault();
        console.log('Quiz form submitted');
        submitQuiz();
      });
    }

    // Attach admin login button listeners
    const adminLoginButtons = document.querySelectorAll('#admin-login-section .btn, #admin-login-section-result .btn');
    adminLoginButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        console.log('Admin login button clicked');
        checkAdminPassword();
      });
    });
  });

  function closeStudentInfoModal() {
    console.log('Closing modal');
    getElement('student-info-modal')?.classList.remove('active');
  }

  function startTest() {
    console.log('Starting test');
    const startScreen = getElement('start-screen');
    const testScreen = getElement('test-screen');
    const timer = getElement('timer');

    if (startScreen && testScreen && timer) {
      startScreen.classList.add('hidden');
      testScreen.classList.remove('hidden');
      timer.classList.remove('hidden');
      loadQuestions();
      startTimer();
    }
  }

  function checkAdminPassword() {
    console.log('Checking admin password');
    const ADMIN_PASSWORD = 'satmakon123';
    const passwordInputs = [
      getElement('admin-password'),
      getElement('admin-password-result')
    ];
    const passwordInput = passwordInputs.find(input => input && input.value);

    if (!passwordInput) {
      console.error('No valid password input found');
      alert('Admin login error');
      return;
    }

    if (passwordInput.value === ADMIN_PASSWORD) {
      console.log('Admin password correct');
      document.querySelectorAll('.admin-only').forEach(el => {
        el.style.display = 'block';
      });
      document.querySelectorAll('#admin-login-section, #admin-login-section-result').forEach(el => {
        el.classList.add('hidden');
      });
      document.querySelectorAll('#admin-actions, #admin-actions-result').forEach(el => {
        el.classList.remove('hidden');
      });
      alert('Admin access granted');
      passwordInput.value = '';
    } else {
      console.log('Admin password incorrect');
      alert('Incorrect password');
      passwordInput.value = '';
    }
  }

  /* Remaining functions unchanged: loadQuestions, startTimer, updateProgress, determineGroup, animateValue, submitQuiz, saveToLocalStorage, downloadAllResults, viewSavedResults, backToResults */
  function loadQuestions() {
    console.log('Loading questions');
    const container = getElement('questions-container');
    if (!container) return;

    container.innerHTML = '';
    
    questions.forEach((q, index) => {
      const inputType = q.multiSelect ? 'checkbox' : 'radio';
      const inputClass = q.multiSelect ? 'option-checkbox' : 'option-radio';
      const div = document.createElement('div');
      div.className = `question ${userAnswers[index] !== null && (Array.isArray(userAnswers[index]) ? userAnswers[index].length > 0 : true) ? 'answered' : ''}`;
      div.innerHTML = `
        <div class="question-number">${index + 1}</div>
        <h3>${q.question}</h3>
        <div class="options">
          ${q.options.map((option, optIndex) => `
            <label class="option ${
              Array.isArray(userAnswers[index])
                ? userAnswers[index].includes(option) ? 'selected' : ''
                : userAnswers[index] === option ? 'selected' : ''
            }">
              <input type="${inputType}" name="q${index}" value="${option}"
                ${Array.isArray(userAnswers[index]) ? (userAnswers[index].includes(option) ? 'checked' : '') : (userAnswers[index] === option ? 'checked' : '')}>
              <span class="${inputClass}"></span>
              <span class="option-text">${option}</span>
            </label>
          `).join('')}
        </div>
      `;
      container.appendChild(div);
    });

    getElement('total-questions').textContent = questions.length;
    
    document.querySelectorAll('.option').forEach(option => {
      option.addEventListener('click', function() {
        console.log('Option clicked:', this);
        const input = this.querySelector('input');
        const questionIndex = parseInt(input.name.substring(1));
        const question = questions[questionIndex];

        if (question.multiSelect) {
          userAnswers[questionIndex] = userAnswers[questionIndex] || [];
          if (input.checked) {
            if (!userAnswers[questionIndex].includes(input.value)) {
              userAnswers[questionIndex].push(input.value);
            }
          } else {
            userAnswers[questionIndex] = userAnswers[questionIndex].filter(val => val !== input.value);
          }
          document.querySelectorAll(`input[name="q${questionIndex}"]`).forEach(inp => {
            inp.closest('.option').classList.toggle('selected', inp.checked);
          });
        } else {
          document.querySelectorAll(`input[name="q${questionIndex}"]`).forEach(inp => {
            inp.closest('.option').classList.remove('selected');
            inp.checked = false;
          });
          input.checked = true;
          this.classList.add('selected');
          userAnswers[questionIndex] = input.value;
        }

        this.closest('.question').classList.toggle('answered', userAnswers[questionIndex] !== null && (Array.isArray(userAnswers[questionIndex]) ? userAnswers[questionIndex].length > 0 : true));
        updateProgress();
      });
    });
  }

  function startTimer() {
    console.log('Starting timer');
    const timerDisplay = getElement('timer-text');
    if (!timerDisplay) return;

    timerInterval = setInterval(() => {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

      if (timeLeft <= 300) {
        getElement('timer').classList.add('low-time');
      }

      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        submitQuiz();
      }
      timeLeft--;
    }, 1000);
  }

  function updateProgress() {
    console.log('Updating progress');
    const answeredCount = userAnswers.filter(answer => answer !== null && (Array.isArray(answer) ? answer.length > 0 : true)).length;
    const totalQuestions = questions.length;
    const progressPercentage = Math.round((answeredCount / totalQuestions) * 100);

    getElement('progress-fill').style.width = `${progressPercentage}%`;
    getElement('current-question').textContent = answeredCount + 1;
    getElement('progress-percent').textContent = `${progressPercentage}%`;
  }

  function determineGroup(score) {
    console.log('Determining group for score:', score);
    if (score >= 0 && score <= 7) {
      return {
        name: 'Pre-Foundation Math',
        message: 'We recommend starting with our Pre-Foundation Math course to build a strong base for your SAT preparation.'
      };
    } else if (score >= 8 && score <= 14) {
      return {
        name: 'Foundation Math',
        message: 'You have a good foundation! Our Foundation Math course will help you strengthen your core concepts before moving to SAT-specific content.'
      };
    } else if (score >= 15 && score <= 25) {
      return {
        name: 'Pre-SAT Math',
        message: 'Great job! You’re ready for our Pre-SAT Math course which focuses on bridging the gap between your current level and SAT requirements.'
      };
    } else if (score >= 26) {
      return {
        name: 'SAT Math',
        message: 'Excellent! You’re ready to dive straight into our SAT Math course focused on advanced strategies and test-taking techniques.'
      };
    }
    return {
      name: 'Unknown Group',
      message: 'Please contact our advisors for a personalized learning plan.'
    };
  }

  function animateValue(id, start, end, duration) {
    console.log('Animating value for:', id);
    const obj = getElement(id);
    if (!obj) return;

    let startTimestamp = null;
    const step = (timestamp) => {
      if (!startTimestamp) startTimestamp = timestamp;
      const progress = Math.min((timestamp - startTimestamp) / duration, 1);
      obj.innerHTML = Math.floor(progress * (end - start) + start);
      if (progress < 1) {
        window.requestAnimationFrame(step);
      }
    };
    window.requestAnimationFrame(step);
  }

  function submitQuiz() {
    console.log('Submitting quiz');
    clearInterval(timerInterval);
    getElement('timer').classList.add('hidden');
    getElement('test-screen').classList.add('hidden');

    let score = 0;
    questions.forEach((q, index) => {
      if (userAnswers[index] !== null) {
        if (q.multiSelect) {
          const correctAnswers = Array.isArray(q.correct) ? q.correct : [q.correct];
          const userAnswer = Array.isArray(userAnswers[index]) ? userAnswers[index] : [userAnswers[index]];
          if (userAnswer.length === correctAnswers.length && userAnswer.every(val => correctAnswers.includes(val))) {
            score++;
          }
        } else {
          if (userAnswers[index] === q.correct) {
            score++;
          }
        }
      }
    });

    const group = determineGroup(score);

    getElement('score-display').textContent = score;
    getElement('group-badge').textContent = group.name;
    getElement('result-message').textContent = group.message;
    getElement('display-name').textContent = studentInfo.name;
    getElement('display-surname').textContent = studentInfo.surname;
    getElement('display-phone').textContent = studentInfo.phone;
    getElement('test-date').textContent = studentInfo.testDate;

    animateValue('score-display', 0, score, 1000);
    getElement('result-screen').classList.remove('hidden');
    getElement('google-form-container').classList.remove('hidden');

    const formUrl = new URL('https://docs.google.com/forms/d/e/1FAIpQLSeWJx3yX8q5x5yX8q5x5yX8q5x5yX8q5x5yX8q5x5yX8q5x5yX8q5/viewform?embedded=true');
    formUrl.searchParams.append('entry.123456789', studentInfo.name);
    formUrl.searchParams.append('entry.987654321', studentInfo.surname);
    formUrl.searchParams.append('entry.555555555', score.toString());
    formUrl.searchParams.append('entry.444444444', group.name);
    formUrl.searchParams.append('entry.333333333', studentInfo.phone);
    formUrl.searchParams.append('entry.222222222', studentInfo.testDate);

    fetch(formUrl, { mode: 'no-cors' })
      .then(() => {
        console.log('Data submitted to Google Forms!');
        saveToLocalStorage({
          studentInfo,
          score,
          totalQuestions: questions.length,
          group: group.name,
          testDate: new Date().toISOString(),
          answers: userAnswers
        });
      })
      .catch(e => {
        console.error('Error submitting to Google Forms:', e);
        saveToLocalStorage({
          studentInfo,
          score,
          totalQuestions: questions.length,
          group: group.name,
          testDate: new Date().toISOString(),
          answers: userAnswers
        });
      });

    confetti({
      particleCount: 150,
      spread: 70,
      origin: { y: 0.6 }
    });
  }

  function saveToLocalStorage(resultData) {
    console.log('Saving to local storage');
    try {
      let localResults = JSON.parse(localStorage.getItem('satmakonResults')) || [];
      localResults.push(resultData);
      localStorage.setItem('satmakonResults', JSON.stringify(localResults));
      console.log('Result saved to local storage');
    } catch (error) {
      console.error('Error saving to local storage:', error);
    }
  }

  function downloadAllResults() {
    console.log('Downloading all results');
    try {
      const savedResults = JSON.parse(localStorage.getItem('satmakonResults')) || [];
      if (!savedResults.length) {
        alert('No results to download');
        return;
      }

      let csvContent = 'Name,Surname,Phone,Score,Total Questions,Group,Test Date\n';
      savedResults.forEach(result => {
        csvContent += `"${result.studentInfo.name}","${result.studentInfo.surname}","${result.studentInfo.phone}",${result.score},${result.totalQuestions},"${result.group}","${new Date(result.testDate).toLocaleString()}"\n`;
      });

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `SATMAKON_Results_${new Date().toISOString().slice(0,10)}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    } catch (error) {
      console.error('Error downloading results:', error);
      alert('Failed to download results.');
    }
  }

  function viewSavedResults() {
    console.log('Viewing saved results');
    const resultsList = getElement('saved-results-list');
    if (!resultsList) return;

    resultsList.innerHTML = '<p>Loading results...</p>';

    try {
      const savedResults = JSON.parse(localStorage.getItem('satmakonResults')) || [];
      resultsList.innerHTML = '';

      if (!savedResults.length) {
        resultsList.innerHTML = '<p>No saved results found.</p>';
      } else {
        savedResults.forEach((result, index) => {
          const resultDiv = document.createElement('div');
          resultDiv.className = 'saved-result-item';
          resultDiv.innerHTML = `
            <h3>Test #${index + 1} - ${result.studentInfo.name} ${result.studentInfo.surname}</h3>
            <div class="saved-result-meta">
              <span><strong>Date:</strong> ${new Date(result.testDate).toLocaleString()}</span>
              <span><strong>Phone:</strong> ${result.studentInfo.phone}</span>
            </div>
            <div class="saved-result-meta">
              <span class="saved-result-score">Score: ${result.score}/${result.totalQuestions}</span>
              <span><strong>Group:</strong> ${result.group}</span>
            </div>
          `;
          resultsList.appendChild(resultDiv);
        });
      }

      getElement('result-screen').classList.add('hidden');
      getElement('saved-results-screen').classList.remove('hidden');
    } catch (error) {
      console.error('Error viewing results:', error);
      resultsList.innerHTML = '<p>Error loading results.</p>';
    }
  }

  function backToResults() {
    console.log('Returning to results screen');
    getElement('saved-results-screen').classList.add('hidden');
    getElement('result-screen').classList.remove('hidden');
  }
</script>
    
</body>
</html>
